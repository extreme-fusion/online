<?php/*********************************************************| eXtreme-Fusion 5| Content Management System|| Copyright (c) 2005-2013 eXtreme-Fusion Crew| http://extreme-fusion.org/|| This program is released as free software under the| Affero GPL license. You can redistribute it and/or| modify it under the terms of this license which you| can read by viewing the included agpl.txt or online| at www.gnu.org/licenses/agpl.html. Removal of this| copyright header is strictly prohibited without| written permission from the original author(s).|**********************************************************                ORIGINALLY BASED ON---------------------------------------------------------+| PHP-Fusion Content Management System| Copyright (C) 2002 - 2011 Nick Jones| http://www.php-fusion.co.uk/+--------------------------------------------------------+| Author: Nick Jones (Digitanium)| Author: Marcus Gottschalk (MarcusG)+--------------------------------------------------------+| This program is released as free software under the| Affero GPL license. You can redistribute it and/or| modify it under the terms of this license which you| can read by viewing the included agpl.txt or online| at www.gnu.org/licenses/agpl.html. Removal of this| copyright header is strictly prohibited without| written permission from the original author(s).+--------------------------------------------------------*/try{	require_once '../../../system/sitecore.php';	$rows = $_pdo->getMatchRowsCount('SELECT * FROM [chat_messages]');	$chat_settings = $_pdo->getRow('SELECT * FROM [chat_settings]');	$_sbb = $ec->sbb;	echo'<script>$(document).ready(function(){$(\'#chat_post\').html('.$rows.');});</script>';	if ($rows)	{		if ($chat_settings['archive_limit'] == 0)		{			$result = $_pdo->getData('SELECT * FROM [chat_messages] ORDER BY `id` ASC');		}		else		{			$result = $_pdo->getData('SELECT * FROM [chat_messages] ORDER BY `id` ASC LIMIT 0,'.intval($chat_settings['archive_limit']));		}		$i =0;		foreach ($result as $row)		{			echo '<div class="'.($i % 2 == 0 ? 'tbl1' : 'tbl2').'">'.$_user->getusername($row['user_id']).': '.$_sbb->parseAllTags($row['content']).' <span class="alt">'.date('d.m.Y H:i:s', $row['datestamp']).'</span></div>';			$i++;		}	}}catch(optException $exception){    optErrorHandler($exception, FALSE);}catch(systemException $exception){    systemErrorHandler($exception, FALSE);}catch(userException $exception){    userErrorHandler($exception, FALSE);}catch(PDOException $exception){    PDOErrorHandler($exception, FALSE);}